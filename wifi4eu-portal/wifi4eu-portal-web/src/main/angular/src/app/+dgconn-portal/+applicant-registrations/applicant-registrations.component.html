<div class="container">
    <div class="ui-g-12" style="margin-top: 1em; font-size: 14px;">
        <a class="link-label" routerLink=".." routerLinkActive="active">
            <i class="fa fa-long-arrow-left" aria-hidden="true"></i> {{ 'shared.back.button' | translate }}
        </a>
        <p class="beneficiaryTitle">{{ 'dgConn.manageApplications.title' | translate }}</p>
        <p>{{ 'dgConn.manageApplications.desc' | translate }}</p>
    </div>
    <div class="ui-g-12 center">
        <p-tabView *ngIf="calls.length > 0" (onChange)="changeCall($event)">
            <p-tabPanel *ngFor="let call of calls; let i = index"
                        header="{{ 'dgConn.call.number' | translate:{number:i+1} }}"
                        [selected]="i == currentIndex">
            </p-tabPanel>
        </p-tabView>
    </div>
    <div class="ui-g-12 center">
        <div class="panel-dg panel-padding panel-input">
            <div class="row">
                <div class="col-md-6">
                    <select [(ngModel)]="country" (ngModelChange)="changeCountry($event)" id="country" name="country" class="form-control"
                            ng-options="option.value as option.name for option in typeOptions" [disabled]="countries.length < 1 || loadingData">
                        <option selected [ngValue]="null">
                            -
                        </option>
                        <option *ngFor="let currentCountry of countries" [ngValue]="currentCountry">
                            {{currentCountry.label}}
                        </option>
                    </select>
                </div>
                <div class="col-md-6">
                    <div class="input-group">
                    <span class="input-group-addon">
                        <i class="fa fa-search" aria-hidden="true"></i>
                    </span>
                        <input type="text" [(ngModel)]="inputSearch" class="form-control" [disabled]="loadingData" (keyup.enter)="inputSearchApplicants()">
                        <span class="input-group-btn">
                        <button class="btn btn-primary" (click)="inputSearchApplicants()" type="button" [disabled]="loadingData">
                            <span *ngIf="!loadingData">{{ 'shared.search.button' | translate }}</span>
                            <span *ngIf="loadingData">
                                <i [@enterSpinner] class="fa fa-spinner loading-icon"></i>
                            </span>
                        </button>
                    </span>
                    </div>
                </div>
            </div>
        </div>
        <div class="panel-dg" *ngIf="calls.length > 0">
            <div class="ui-g-12" style="padding: 1em 2em;border-bottom: 1px solid #bdbdbd;">
                <a class="link-label right" [class.link-disabled]="loadingData || downloadingList" (click)="exportListExcel()">
                    <i class="fa fa-download" aria-hidden="true"></i> {{ 'shared.download' | translate }} <i *ngIf="downloadingList" [@enterSpinner] class="fa fa-spinner loading-icon"></i>
                </a>
            </div>
            <p-dataTable #tableBeneficiary [value]="applicantListItems" [lazy]="true" (onLazyLoad)="loadData($event)"
                         [paginator]="true" [rowsPerPageOptions]="rowsPerPageOptions" [totalRecords]="totalItems" [rows]="itemsPerPage">
                <p-column field="countryCode" [sortable]="true" header="{{ 'dgConn.beneficiaries.country' | translate }}" styleClass="text-center"></p-column>
                <p-column field="name" [sortable]="true" header="{{ 'dgConn.beneficiaries.name' | translate }}" styleClass="text-center"></p-column>
                <p-column field="status" [sortable]="true" header="{{ 'dgConn.status' | translate }}" styleClass="text-center">
                    <ng-template let-row="rowData" pTemplate="body">
                        <span *ngIf="row.status == -1">-</span>
                        <span *ngIf="row.status == 0">{{ 'dgConn.beneficiaries.applied' | translate }}</span>
                        <span *ngIf="row.status == 1">{{ 'dgConn.status.invalidated' | translate }}</span>
                        <span *ngIf="row.status == 2">{{ 'dgConn.status.validated' | translate }}</span>
                    </ng-template>
                </p-column>
                <p-column field="issueStatus" [sortable]="false" header="{{ 'dgConn.issues' | translate }}" styleClass="text-center">
                    <ng-template let-row="rowData" pTemplate="body">
                        <span *ngIf="row.issueStatus == 0">-</span>
                        <span *ngIf="row.issueStatus == 1 || row.issueStatus == 2" class="badge badge-warning">
                            {{ 'dgConn.badge.warning' | translate }} {{ row.issueStatus }}
                        </span>
                        <span *ngIf="row.issueStatus == 3" class="badge badge-warning-yellow">
                            {{ 'dgConn.badge.warning' | translate }} {{ row.issueStatus }}
                        </span>
                    </ng-template>
                </p-column>
                <p-column field="counter" [sortable]="true" header="{{ 'dgConn.number.registrations' | translate }}" styleClass="text-center"></p-column>
                <p-column field="mediation" [sortable]="true" header="{{ 'dgConn.beneficiaries.mediation' | translate }}" styleClass="text-center">
                    <ng-template let-row="rowData" pTemplate="body">
                        <span *ngIf="row.mediation">{{'dgConn.yes' | translate }}</span>
                        <span *ngIf="!row.mediation">{{'dgConn.no' | translate }}</span>
                    </ng-template>
                </p-column>
                <p-column [sortable]="false" header="{{ 'dgConn.details' | translate }}" styleClass="text-center">
                    <ng-template let-row="rowData" pTemplate="body">
                    <span [routerLink]="['./', row.lauId, 'call', currentCall.id]" routerLinkActive="active" class="action-label">
                        <span class="fa fa-eye"></span> <span>{{ 'dgConn.view' | translate }}</span>
                    </span>
                    </ng-template>
                </p-column>
                <footer>
                    <div style="position: absolute; bottom: 25px; left: 20px;">
                    <span *ngIf="!loadingData">
                        {{ 'dgConn.totalRecords' | translate }} {{tableBeneficiary.totalRecords}}
                    </span>
                        <span *ngIf="loadingData">
                        {{ 'shared.loading.modal.title' | translate }} <i [@enterSpinner] class="fa fa-spinner loading-icon"></i>
                    </span>
                    </div>
                </footer>
            </p-dataTable>
        </div>
    </div>
</div>